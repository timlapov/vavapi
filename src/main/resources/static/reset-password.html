<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
</head>

<body>

<p id="feedback"></p>
<form>
    <label>
        New Password
        <input type="password" required name="password" id="password">
    </label>

    <label>
        Password Repeat
        <input type="password" required name="password-repeat" id="password-repeat">
    </label>
    <button>Change password</button>
</form>

<script>
    const form = document.querySelector('form');
    const feedback = document.querySelector('#feedback');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        feedback.textContent = '';
        const params = new URLSearchParams(document.location.search);
        if (!params.has('token')) {
            feedback.textContent = 'Token is missing';
            return;
        }

        const data = new FormData(form);
        if (data.get('password') !== data.get('password-repeat')) {
            feedback.textContent = 'Passwords do not match';
            return;
        }

        const response = await fetch('/api/account/password', {
            method: 'PATCH',
            headers: {
                'Authorization': 'Bearer ' + params.get('token'),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({newPassword: data.get('password')})
        });

        if(response.status == 200) {
            feedback.textContent = 'Password modified successfuly';
        } else {
            feedback.textContent = 'Error modifying password';
        }

    });
</script>
</body>

</html>